var Configuration = angular.module('ivNet.Configuration', ['ngResource', 'trNgGrid']);

Configuration.factory('customconfiguration', function ($resource) {
    return $resource('/api/listing/configuration/:id', null,
    {
        'delete': { method: 'Delete' },
    });
});

Configuration.factory('configuration', function ($resource) {
    return $resource('/api/listing/configuration/:id', null,
    {
        'query': { method: 'GET', isArray: false },
        'save': { method: 'Post' },
    });
});

Configuration.controller('ConfigurationController', function ($scope, $filter, configuration, customconfiguration) {

    $scope.removeCategory = function(item) {
        var categoryItemIndex = -1;
        $.each($scope.categories, function(categoryIndex, categoryItem) {
            if (categoryItem.Id == item.Id) {
                categoryItemIndex = categoryIndex;
            }
        });

        customconfiguration.delete({ id: item.Id, type: 'category' },
            function(data) {
                $scope.categories.splice(categoryItemIndex, 1);
            },
            function(error) {
                alert(error.data.Message + ' [' + error.data.MessageDetail + ']');
            });

    };

    $scope.addCategory = function () {

        var category = { 'Type': 'category', 'Name': $scope.categoryName }

        customconfiguration.save(JSON.stringify(category),
            function (data) {
                $scope.categories.push({ Id: data.Id, Name: data.Name });

                $scope.categories = $filter('orderBy')($scope.categories, "Name")
            },
            function (error) {
                alert(error.data.Message + ' [' + error.data.MessageDetail + ']');
            });

        //var da = { "Id": 3, "FirstName": "Test", "LastName": "User", "Username": "testuser", "IsApproved": true, "IsOnlineNow": true, "IsChecked": true };
        //$http.post(
        //    '/api/values',
        //    JSON.stringify(data),
        //    {
        //        headers: {
        //            'Content-Type': 'application/json'
        //        }
        //    }
        //).success(function (data) {
        //    $scope.person = data;
        //});
    };

    init();

    function init() {

        configuration.query({},
            function(data) {
                $scope.categories = $filter('orderBy')(data.Categories, "Name");
            },
            function(error) {
                alert(error.data.Message + ' [' + error.data.MessageDetail + ']');
            });
    }

});